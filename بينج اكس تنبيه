import requests
import time
import datetime

# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
bot_token = "7842436262:AAHPMbzYO-Kzrl5k33Gdw4yc_6i2qcAnnik"
chat_id = "5316104346"

# Ø¨ÙŠØ§Ù†Ø§Øª BingX API
api_key = "BA0ipq2dFUZ7JiDTy41fkMdX2QX2 ni7FrXQQ93ZCvo1Hsj7gSYrkrkQk4 hvTGkeeu0ekrrBAZHDmJFNTZPIyA"
secret_key = "mpawe74izq7jFwcblGqKFXDYQ4uwiQLrLF7w VseJ1qEyVZWLziUuY9HCV6wASr12K8pqlwY bo4RG8OeJKWFndA"

# Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù„ÙŠ Ù‡Ù†Ø´ØªØºÙ„ Ø¹Ù„ÙŠÙ‡Ø§
symbols = ["BTC-USDT", "ETH-USDT", "SOL-USDT", "XRP-USDT", "BNB-USDT"]

# Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
def send_telegram_message(message):
    url = f"https://api.telegram.org/bot{bot_token}/sendMessage"
    payload = {
        "chat_id": chat_id,
        "text": message
    }
    try:
        response = requests.post(url, data=payload)
        if response.status_code != 200:
            print("Error sending message:", response.text)
    except Exception as e:
        print("Exception:", e)

# Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¹Ø± Ù…Ù† BingX
def get_price(symbol):
    url = "https://open-api.bingx.com/openApi/spot/v1/ticker/price"
    params = {
        "symbol": symbol
    }
    headers = {
        "X-BX-APIKEY": api_key
    }
    try:
        response = requests.get(url, params=params, headers=headers)
        data = response.json()
        return float(data['data']['price'])
    except Exception as e:
        print("Exception getting price:", e)
        return None

# Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (Ù…ÙƒØ§Ù†Ù‡Ø§ Ù†Ø·ÙˆØ±Ù‡ Ø¨Ø¹Ø¯ÙŠÙ† Ø¨Ù…Ø¤Ø´Ø±Ø§Øª ÙˆØªÙ‚Ù†ÙŠØ§Øª)
def predict_next_6_candles(current_price):
    prediction = []
    for i in range(6):
        delta = 0.1 * (i+1)  # Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨Ø³ÙŠØ· Ù„Ù„Ø´Ø±Ø­
        prediction.append(round(current_price + delta, 2))
    return prediction

# Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø³Ø¹Ø± Ø®Ù„Ø§Ù„ Ø¢Ø®Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚
def calculate_price_change(initial_price, current_price):
    change = ((current_price - initial_price) / initial_price) * 100
    return round(change, 2)

# Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
def main():
    previous_prices = {symbol: None for symbol in symbols}  # Ù„Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©
    while True:
        final_message = ""
        for symbol in symbols:
            price = get_price(symbol)
            if price:
                # Ù†Ø­Ø¯Ø¯ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
                initial_price = previous_prices[symbol] if previous_prices[symbol] else price
                price_change = calculate_price_change(initial_price, price)
                
                # ØªÙˆÙ‚Ø¹ 6 Ø´Ù…Ø¹Ø§Øª Ù‚Ø§Ø¯Ù…Ø©
                prediction = predict_next_6_candles(price)
                
                # ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØºÙŠØ± Ø§Ù„Ø³Ø¹Ø± Ù„ØµØ§Ù„Ø­ Ù„ÙˆÙ†Ø¬ Ø£Ùˆ Ø´ÙˆØ±Øª
                trend = "Ù„ÙˆÙ†Ø¬ ğŸš€" if price_change > 0 else "Ø´ÙˆØ±Øª ğŸ“‰"
                
                # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©
                final_message = f"ğŸ”µ Ø¹Ù…Ù„Ø©: {symbol}\n"
                final_message += f"Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: {price}\n"
                final_message += f"Ø§Ù„ØªØºÙŠØ± Ø¢Ø®Ø± 5 Ø¯Ù‚Ø§Ø¦Ù‚: {price_change}% ({trend})\n"
                final_message += f"ØªÙˆÙ‚Ø¹ Ù¦ Ø´Ù…Ø¹Ø§Øª Ù‚Ø§Ø¯Ù…Ø©: {prediction}\n"
                final_message += f"â° ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«: {datetime.datetime.now().strftime('%H:%M:%S')}\n"

                # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„ÙƒÙ„ Ø¹Ù…Ù„Ø©
                send_telegram_message(final_message)
                print(f"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©: {symbol}")

                # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø¹Ù…Ù„Ø©
                previous_prices[symbol] = price

        time.sleep(120)  # ÙƒÙ„ 2 Ø¯Ù‚ÙŠÙ‚Ø©

if __name__ == "__main__":
    main()
